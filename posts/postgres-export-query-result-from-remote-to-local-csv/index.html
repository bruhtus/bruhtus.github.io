<!doctype html><html>
<head>
<title>
Postgresql Export Query Result From Remote to Local in CSV file
</title>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Robertus Chris">
<link rel="shortcut icon" type=image/x-icon href=https://bruhtus.github.io/img/favicon.ico>
<link rel=stylesheet href=https://bruhtus.github.io/style.min.4f970aa135421035a71bdc9bbd750aa2cfbe0ddb080ab1ec5db4173f45494cad.css integrity="sha256-T5cKoTVCEDWnG9ybvXUKos++DdsICrHsXbQXP0VJTK0=">
<link disabled rel=stylesheet href=https://bruhtus.github.io/style-dark.min.0a647fb6c07e04b77b54fa0515d0a683d39ecdb251dba960fe1f966f7ff36fc2.css media="(prefers-color-scheme: dark)" integrity="sha256-CmR/tsB+BLd7VPoFFdCmg9OezbJR26lg/h+Wb3/zb8I=">
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.8.1/css/all.css integrity=sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf crossorigin=anonymous>
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css2?family=Bitter:wght@300&family=EB+Garamond&family=PT+Sans&family=Sura&family=Zilla+Slab&family=Inconsolata&family=Libre+Baskerville&display=swap" rel=stylesheet>
<link rel=stylesheet href=https://bruhtus.github.io/css/custom.css>
<meta property="og:title" content="Postgresql Export Query Result From Remote to Local in CSV file">
<meta property="og:description" content="A Brief Intro Have you ever thought of how to get postgresql query result from remote server to our local machine?
If so, this short post might be for you.
How? Before we start, please keep in mind that there are other methods to get postgresql query result from remote server to local machine, the method that i mentioned after this is the easier method for me.
Alright, let&rsquo;s get to it!">
<meta property="og:type" content="article">
<meta property="og:url" content="https://bruhtus.github.io/posts/postgres-export-query-result-from-remote-to-local-csv/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2023-07-25T04:22:04+07:00">
<meta property="article:modified_time" content="2023-07-25T04:22:04+07:00">
<meta itemprop=name content="Postgresql Export Query Result From Remote to Local in CSV file">
<meta itemprop=description content="A Brief Intro Have you ever thought of how to get postgresql query result from remote server to our local machine?
If so, this short post might be for you.
How? Before we start, please keep in mind that there are other methods to get postgresql query result from remote server to local machine, the method that i mentioned after this is the easier method for me.
Alright, let&rsquo;s get to it!"><meta itemprop=datePublished content="2023-07-25T04:22:04+07:00">
<meta itemprop=dateModified content="2023-07-25T04:22:04+07:00">
<meta itemprop=wordCount content="266">
<meta itemprop=keywords content="Notes,Postgresql,"><meta name=twitter:card content="summary">
<meta name=twitter:image content="https://bruhtus.github.io//img/">
<meta name=twitter:title content="Postgresql Export Query Result From Remote to Local in CSV file">
<meta name=twitter:description content="A Brief Intro Have you ever thought of how to get postgresql query result from remote server to our local machine?
If so, this short post might be for you.
How? Before we start, please keep in mind that there are other methods to get postgresql query result from remote server to local machine, the method that i mentioned after this is the easier method for me.
Alright, let&rsquo;s get to it!"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<h1>Postgresql Export Query Result From Remote to Local in CSV file</h1>
<header>
<div class=cd>
<h2><a style=text-decoration:none class=cd href=https://bruhtus.github.io/posts>cd ..</a> || <a style=text-decoration:none class=cd href=https://bruhtus.github.io/>cd</a></h2>
</div>
</header>
<p class=date>
July 25, 2023
<span>&#183;</span>
2 mins
<span>&#183;</span>
Robertus Chris
</p>
<div id=tags>
<ul>
<li><a style=text-decoration:none href=https://bruhtus.github.io/tags/notes/>Notes</a></li>
<li><a style=text-decoration:none href=https://bruhtus.github.io/tags/postgresql/>Postgresql</a></li>
</ul>
</div>
<div class=toc>
<details>
<summary>
<div class=details>Table of Contents</div>
</summary>
<blockquote><ul><li>
<a style=text-decoration:none href=#a-brief-intro aria-label="A Brief Intro">A Brief Intro</a></li><li>
<a style=text-decoration:none href=#how aria-label=How?>How?</a></li><li>
<a style=text-decoration:none href=#references aria-label=References>References</a></li></ul>
</blockquote>
</details>
</div>
<div id=contentBody>
<h2 id=a-brief-intro>A Brief Intro</h2>
<p>Have you ever thought of how to get postgresql query result from remote server
to our local machine?</p>
<p>If so, this short post might be for you.</p>
<h2 id=how>How?</h2>
<p>Before we start, please keep in mind that there are other methods to get
postgresql query result from remote server to local machine, the method that i
mentioned after this is the easier method for me.</p>
<p>Alright, let&rsquo;s get to it!</p>
<p>Before we start, you need to configure the ssh stuff like private key and so
on. So i will assume you already set it up in your ssh config.</p>
<p>In this post we&rsquo;ll use <code>psql</code> to get the query result and <code>copy()</code> function
from postgresql.</p>
<p>Now, let&rsquo;s say we have this query:</p>
<div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=color:#6ab825;font-weight:700>SELECT</span><span style=color:#666> </span><span style=color:#6ab825;font-weight:700>count</span>(*)<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>as</span><span style=color:#666> </span>user_count<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>FROM</span><span style=color:#666> </span>users;<span style=color:#666>
</span></code></pre></div><p>and we want to put those query result in <code>user-count.csv</code>.</p>
<p>The first thing we need to do is make a <code>query</code> file with the sql query above
and <code>copy()</code> like this:</p>
<div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=color:#6ab825;font-weight:700>copy</span>(<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>SELECT</span><span style=color:#666> </span><span style=color:#6ab825;font-weight:700>count</span>(*)<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>as</span><span style=color:#666> </span>user_count<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>FROM</span><span style=color:#666> </span>users;<span style=color:#666>
</span><span style=color:#666></span>)<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>TO</span><span style=color:#666> </span><span style=color:#6ab825;font-weight:700>stdout</span><span style=color:#666> </span><span style=color:#6ab825;font-weight:700>WITH</span><span style=color:#666> </span>csv<span style=color:#666> </span>header<span style=color:#666>
</span></code></pre></div><p>For simplicity, we will put those sql query in a file called <code>query</code>. After
that, we can use this command:</p>
<div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh>ssh server-config <span style=color:#ed9d13>&#39;psql -d postgresql://user:password@localhost:5432/db-name&#39;</span> &lt; query
</code></pre></div><p>Please keep in mind that <code>server-config</code> is our ssh configuration in
<code>~/.ssh/config</code>, and <code>postgresql://user:password@localhost:5432/db-name</code> is
our postgresql data source name (DSN).</p>
<p>If our query has result, we will see them in our terminal. Now to put those
result in csv file, we can use redirection like this:</p>
<div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh>ssh server-config <span style=color:#ed9d13>&#39;psql -d postgresql://user:password@localhost:5432/db-name&#39;</span> &lt; query &gt; user-count.csv
</code></pre></div><p>And, that&rsquo;s it. Now we have our query result in csv file. Alright, see you
next time!</p>
<h2 id=references>References</h2>
<ul>
<li><a href=https://stackoverflow.com/a/49992062 target=_blank rel="noreferrer noopener">Stackoverflow ssh with psql</a>
.</li>
<li><a href=https://stackoverflow.com/a/28803698 target=_blank rel="noreferrer noopener">Stackoverflow psql using stdin</a>
.</li>
</ul>
</div>
<footer>
<p>
&copy; 2020-present <a style=text-decoration:none href=https://bruhtus.github.io/resume target=_blank rel="noreferrer noopener">Robertus Chris</a>
<span>&#183;</span>
<a style=text-decoration:none href=https://bruhtus.github.io/index.xml target=_blank rel="noreferrer noopener">RSS Feed</a>
<span>&#183;</span>
Based on <a style=text-decoration:none href=https://github.com/koirand/pulp/ target=_blank rel="noreferrer noopener">pulp</a> and <a style=text-decoration:none href=https://github.com/adityatelange/hugo-PaperMod target=_blank rel="noreferrer noopener">papermod</a> theme
</p>
</footer>
<button onclick=topFunction() id=myBtn title="Go to top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d0d0d0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 15l-6-6-6 6"/></svg>
</button>
<script>var mybutton=document.getElementById("myBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://bruhtus.github.io/js/custom.js></script>
</body>
</html>