<!doctype html><html>
<head>
<title>
Postgres Update Multiple Rows With Unnest Function
</title>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Robertus Chris">
<link rel="shortcut icon" type=image/x-icon href=https://bruhtus.github.io/img/favicon.ico>
<link rel=stylesheet href=https://bruhtus.github.io/style.min.4f970aa135421035a71bdc9bbd750aa2cfbe0ddb080ab1ec5db4173f45494cad.css integrity="sha256-T5cKoTVCEDWnG9ybvXUKos++DdsICrHsXbQXP0VJTK0=">
<link disabled rel=stylesheet href=https://bruhtus.github.io/style-dark.min.0a647fb6c07e04b77b54fa0515d0a683d39ecdb251dba960fe1f966f7ff36fc2.css media="(prefers-color-scheme: dark)" integrity="sha256-CmR/tsB+BLd7VPoFFdCmg9OezbJR26lg/h+Wb3/zb8I=">
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.8.1/css/all.css integrity=sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf crossorigin=anonymous>
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css2?family=Bitter:wght@300&family=EB+Garamond&family=PT+Sans&family=Sura&family=Zilla+Slab&family=Inconsolata&family=Libre+Baskerville&display=swap" rel=stylesheet>
<link rel=stylesheet href=https://bruhtus.github.io/css/custom.css>
<meta property="og:title" content="Postgres Update Multiple Rows With Unnest Function">
<meta property="og:description" content="A Brief Intro At work, i need to build an API that enable user to update specific info in multiple rows. Previously, i made a blog post about postgres update multiple data in one query , but those method is more convenient for running raw sql in the postgresql database directly rather than for API. I mean, sure, we can use FROM (values (...), (...), ...) but personally, i don&rsquo;t really want to compose multiple values with positional parameters in postgres.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://bruhtus.github.io/posts/postgres-update-multiple-rows-with-unnest-function/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2025-07-15T12:56:22+07:00">
<meta property="article:modified_time" content="2025-07-15T12:56:22+07:00">
<meta itemprop=name content="Postgres Update Multiple Rows With Unnest Function">
<meta itemprop=description content="A Brief Intro At work, i need to build an API that enable user to update specific info in multiple rows. Previously, i made a blog post about postgres update multiple data in one query , but those method is more convenient for running raw sql in the postgresql database directly rather than for API. I mean, sure, we can use FROM (values (...), (...), ...) but personally, i don&rsquo;t really want to compose multiple values with positional parameters in postgres."><meta itemprop=datePublished content="2025-07-15T12:56:22+07:00">
<meta itemprop=dateModified content="2025-07-15T12:56:22+07:00">
<meta itemprop=wordCount content="327">
<meta itemprop=keywords content="Notes,Postgresql,"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<h1>Postgres Update Multiple Rows With Unnest Function</h1>
<header>
<div class=cd>
<h2><a style=text-decoration:none class=cd href=https://bruhtus.github.io/posts>cd ..</a> || <a style=text-decoration:none class=cd href=https://bruhtus.github.io/>cd</a></h2>
</div>
</header>
<p class=date>
July 15, 2025
<span>&#183;</span>
2 mins
<span>&#183;</span>
Robertus Chris
</p>
<div id=tags>
<ul>
<li><a style=text-decoration:none href=https://bruhtus.github.io/tags/notes/>Notes</a></li>
<li><a style=text-decoration:none href=https://bruhtus.github.io/tags/postgresql/>Postgresql</a></li>
</ul>
</div>
<div class=toc>
<details>
<summary>
<div class=details>Table of Contents</div>
</summary>
<blockquote><ul><li>
<a style=text-decoration:none href=#a-brief-intro aria-label="A Brief Intro">A Brief Intro</a></li><li>
<a style=text-decoration:none href=#unnest-function aria-label="Unnest Function">Unnest Function</a></li><li>
<a style=text-decoration:none href=#references aria-label=References>References</a></li></ul>
</blockquote>
</details>
</div>
<div id=contentBody>
<h2 id=a-brief-intro>A Brief Intro</h2>
<p>At work, i need to build an API that enable user to update specific info in
multiple rows. Previously, i made a blog post about <a href=../postgres-update-multiple-rows-in-one-query>postgres update multiple
data in one query</a>
, but those
method is more convenient for running raw sql in the postgresql database
directly rather than for API. I mean, sure, we can use
<code>FROM (values (...), (...), ...)</code> but personally, i don&rsquo;t really want to
compose multiple values with positional parameters in postgres.
And since we use <code>pgx</code> in golang as our postgres driver, i thought
&ldquo;can we put all the info we need in an array when trying to update multiple
values?&rdquo;, and looks like we can!</p>
<h2 id=unnest-function>Unnest Function</h2>
<p>I learn about the existence of <code>unnest()</code> from this website:<br>
<a href=https://www.w3resource.com/PostgreSQL/postgresql_unnest-function.php target=_blank rel="noreferrer noopener">https://www.w3resource.com/PostgreSQL/postgresql_unnest-function.php</a>
</p>
<p>So, what i do is that i put all the data in a golang array. Let&rsquo;s say we have
<code>pgx</code> named arguments <code>@ids</code> to hold all ids that we want to update, which in
this case let&rsquo;s assume we use UUID as our id, and then <code>@price</code> to hold the data
that we want to update. And the table we want to update is called <code>meat</code>.</p>
<p>After validation and all those stuff, we get the necessary data and this is
the query for updating multiple data with <code>unnest()</code> for <code>pgx</code> golang:</p>
<div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=color:#6ab825;font-weight:700>UPDATE</span><span style=color:#666> </span>meat<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>as</span><span style=color:#666> </span>m<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>SET</span><span style=color:#666> </span>price<span style=color:#666> </span>=<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>c</span>.price<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>FROM</span><span style=color:#666> </span><span style=color:#6ab825;font-weight:700>unnest</span>(@ids::uuid[],<span style=color:#666> </span>@price::<span style=color:#24909d>int</span>[])<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>as</span><span style=color:#666> </span><span style=color:#6ab825;font-weight:700>c</span>(id,<span style=color:#666> </span>price)<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>WHERE</span><span style=color:#666> </span>m.id<span style=color:#666> </span>=<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>c</span>.id<span style=color:#666>
</span><span style=color:#666></span>RETURNING<span style=color:#666> </span>m.*<span style=color:#666>
</span></code></pre></div><p>The equivalent raw sql would be like this:</p>
<div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=color:#6ab825;font-weight:700>UPDATE</span><span style=color:#666> </span>meat<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>as</span><span style=color:#666> </span>m<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>SET</span><span style=color:#666> </span>price<span style=color:#666> </span>=<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>c</span>.price<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>FROM</span><span style=color:#666> </span><span style=color:#6ab825;font-weight:700>unnest</span>(<span style=color:#666>
</span><span style=color:#666>    </span><span style=color:#24909d>array</span>[<span style=color:#ed9d13>&#39;...&#39;</span>,<span style=color:#666> </span><span style=color:#ed9d13>&#39;...&#39;</span>]::uuid[],<span style=color:#666>
</span><span style=color:#666>    </span><span style=color:#24909d>array</span>[<span style=color:#3677a9>69</span>,<span style=color:#666> </span><span style=color:#3677a9>42</span>]::<span style=color:#24909d>int</span>[]<span style=color:#666>
</span><span style=color:#666></span>)<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>as</span><span style=color:#666> </span><span style=color:#6ab825;font-weight:700>c</span>(id,<span style=color:#666> </span>price)<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>WHERE</span><span style=color:#666> </span>m.id<span style=color:#666> </span>=<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>c</span>.id<span style=color:#666>
</span><span style=color:#666></span>RETURNING<span style=color:#666> </span>m.*<span style=color:#666>
</span></code></pre></div><p>Please keep in mind that we need to specify the array type in postgres like
<code>uuid[]</code> and <code>int[]</code> because apparently <code>pgx</code> using array in string format
like <code>unnest('{1, 2, 3}')</code> so postgres get confused and throw an error
<code>unnest(unknown) ... unique</code> (?). This is still an assumption and might be
incorrect but the query is working fine after casting the type.</p>
<p>Also, i&rsquo;m still not sure about the performance of using postgres <code>unnest()</code> so
it&rsquo;s something to keep in mind.</p>
<p>All right, that&rsquo;s it. See you next time!</p>
<h2 id=references>References</h2>
<ul>
<li><a href=https://www.w3resource.com/PostgreSQL/postgresql_unnest-function.php target=_blank rel="noreferrer noopener">w3resource about postgresql unnest() function</a>
</li>
<li><a href=https://stackoverflow.com/a/52682829 target=_blank rel="noreferrer noopener">Stackoverflow answer about unnest(unknown)
error</a>
</li>
</ul>
</div>
<footer>
<p>
&copy; 2020-present <a style=text-decoration:none href=https://github.com/bruhtus/resume target=_blank rel="noreferrer noopener">Robertus Chris</a>
<span>&#183;</span>
<a style=text-decoration:none href=https://bruhtus.github.io/index.xml target=_blank rel="noreferrer noopener">RSS Feed</a>
<span>&#183;</span>
Based on <a style=text-decoration:none href=https://github.com/koirand/pulp/ target=_blank rel="noreferrer noopener">pulp</a> and <a style=text-decoration:none href=https://github.com/adityatelange/hugo-PaperMod target=_blank rel="noreferrer noopener">papermod</a> theme
</p>
</footer>
<button onclick=topFunction() id=myBtn title="Go to top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d0d0d0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 15l-6-6-6 6"/></svg>
</button>
<script>var mybutton=document.getElementById("myBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://bruhtus.github.io/js/custom.js></script>
</body>
</html>