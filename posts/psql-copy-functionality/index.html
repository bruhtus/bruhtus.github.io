<!doctype html><html>
<head>
<title>
Psql Copy Functionality
</title>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Robertus Chris">
<link rel="shortcut icon" type=image/x-icon href=https://bruhtus.github.io/img/favicon.ico>
<link rel=stylesheet href=https://bruhtus.github.io/style.min.4f970aa135421035a71bdc9bbd750aa2cfbe0ddb080ab1ec5db4173f45494cad.css integrity="sha256-T5cKoTVCEDWnG9ybvXUKos++DdsICrHsXbQXP0VJTK0=">
<link disabled rel=stylesheet href=https://bruhtus.github.io/style-dark.min.0a647fb6c07e04b77b54fa0515d0a683d39ecdb251dba960fe1f966f7ff36fc2.css media="(prefers-color-scheme: dark)" integrity="sha256-CmR/tsB+BLd7VPoFFdCmg9OezbJR26lg/h+Wb3/zb8I=">
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.8.1/css/all.css integrity=sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf crossorigin=anonymous>
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css2?family=Bitter:wght@300&family=EB+Garamond&family=PT+Sans&family=Sura&family=Zilla+Slab&family=Inconsolata&family=Libre+Baskerville&display=swap" rel=stylesheet>
<link rel=stylesheet href=https://bruhtus.github.io/css/custom.css>
<meta property="og:title" content="Psql Copy Functionality">
<meta property="og:description" content="A Brief Intro I need to replace data on one database server with data on another database server. Let&rsquo;s call it server 1 for the source server and server 2 for the target server. But there are 2 limitations:
 We only need to replace data on specific table. We only able to access the database through psql with VPN (at least that&rsquo;s how i understand it).  With that in mind, i&rsquo;m trying to solve those problem with psql \copy.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://bruhtus.github.io/posts/psql-copy-functionality/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2025-07-16T13:06:58+07:00">
<meta property="article:modified_time" content="2025-07-16T13:06:58+07:00">
<meta itemprop=name content="Psql Copy Functionality">
<meta itemprop=description content="A Brief Intro I need to replace data on one database server with data on another database server. Let&rsquo;s call it server 1 for the source server and server 2 for the target server. But there are 2 limitations:
 We only need to replace data on specific table. We only able to access the database through psql with VPN (at least that&rsquo;s how i understand it).  With that in mind, i&rsquo;m trying to solve those problem with psql \copy."><meta itemprop=datePublished content="2025-07-16T13:06:58+07:00">
<meta itemprop=dateModified content="2025-07-16T13:06:58+07:00">
<meta itemprop=wordCount content="452">
<meta itemprop=keywords content="Notes,Postgresql,"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<h1>Psql Copy Functionality</h1>
<header>
<div class=cd>
<h2><a style=text-decoration:none class=cd href=https://bruhtus.github.io/posts>cd ..</a> || <a style=text-decoration:none class=cd href=https://bruhtus.github.io/>cd</a></h2>
</div>
</header>
<p class=date>
July 16, 2025
<span>&#183;</span>
3 mins
<span>&#183;</span>
Robertus Chris
</p>
<div id=tags>
<ul>
<li><a style=text-decoration:none href=https://bruhtus.github.io/tags/notes/>Notes</a></li>
<li><a style=text-decoration:none href=https://bruhtus.github.io/tags/postgresql/>Postgresql</a></li>
</ul>
</div>
<div class=toc>
<details>
<summary>
<div class=details>Table of Contents</div>
</summary>
<blockquote><ul><li>
<a style=text-decoration:none href=#a-brief-intro aria-label="A Brief Intro">A Brief Intro</a></li><li>
<a style=text-decoration:none href=#copy-to aria-label="\copy to">\copy to</a></li><li>
<a style=text-decoration:none href=#copy-from aria-label="\copy from">\copy from</a></li><li>
<a style=text-decoration:none href=#conclusions aria-label=Conclusions>Conclusions</a></li><li>
<a style=text-decoration:none href=#references aria-label=References>References</a></li></ul>
</blockquote>
</details>
</div>
<div id=contentBody>
<h2 id=a-brief-intro>A Brief Intro</h2>
<p>I need to replace data on one database server with data on another database
server. Let&rsquo;s call it server 1 for the source server and server 2 for the
target server. But there are 2 limitations:</p>
<ul>
<li>We only need to replace data on specific table.</li>
<li>We only able to access the database through psql with VPN (at least that&rsquo;s
how i understand it).</li>
</ul>
<p>With that in mind, i&rsquo;m trying to solve those problem with <code>psql \copy</code>. Why
did i use <code>\copy</code> instead of sql <code>copy</code>? From postgres documentation:<br></p>
<blockquote>
<p>file accessibility and access rights depends on the client rather than the
server when <code>\copy</code> is used.</p>
</blockquote>
<p>If i want to retrieve the file on my local machine, using <code>\copy</code> is more
convenient as i use <code>psql</code> on my local machine.</p>
<h2 id=copy-to>\copy to</h2>
<p>Assuming we already inside <code>psql</code>, to copy the data from database table to csv
file, we can do some like this:</p>
<pre tabindex=0><code>\copy (SELECT * FROM meat) to '/home/user/meat.csv' with csv header
</code></pre><p>Here&rsquo;s the breakdown of the previous command means:</p>
<ul>
<li><code>SELECT * FROM meat</code> is the sql query to get the data we want.</li>
<li><code>to '/home/user/meat.csv'</code> is the target where we want the data go into. In
this case, the data will be saved in <code>/home/user/meat.csv</code>.</li>
<li><code>with csv header</code> is to include the column in the specified table from the
select query as a csv header. This can be useful in case we want to debug the
query result from csv file.</li>
</ul>
<h2 id=copy-from>\copy from</h2>
<p>Assuming we already inside <code>psql</code>, we already got the data source we want, and
we already delete all the existing data (keep in mind that in this scenario,
we need to replace the data). After the preparation is done, we can use this
command:</p>
<pre tabindex=0><code>\copy meat from '/home/user/meat.csv' delimiter ',' csv header
</code></pre><p>Here&rsquo;s the breakdown of the previous command means:</p>
<ul>
<li><code>meat</code> is the target table we need to fill in.</li>
<li><code>from '/home/user/meat.csv'</code> is the target path that have the data we want.</li>
<li><code>delimiter ','</code> is to indicate a delimiter to split the data.</li>
<li><code>csv header</code> is to indicate that the first row contains the header.</li>
</ul>
<h2 id=conclusions>Conclusions</h2>
<p>Keep in mind that this is only one of the solution to solve the problem of
replacing data from one database server to another database server and this
might not be the best solution. So rather than focusing on the scenario, just
treat it as something to help us understand the mechanism of <code>psql \copy</code>. The
point of this post is to let you know about the existence of <code>psql \copy</code> and
you can tweak it according to your need.</p>
<p>All right, that&rsquo;s it. See you next time!</p>
<h2 id=references>References</h2>
<ul>
<li><a href=https://dba.stackexchange.com/a/167076 target=_blank rel="noreferrer noopener">Stackexchange psql copy answer</a>
.</li>
<li><a href=https://www.postgresql.org/docs/current/sql-copy.html target=_blank rel="noreferrer noopener">Postgresql copy sql
documentation</a>
.</li>
</ul>
</div>
<footer>
<p>
&copy; 2020-present <a style=text-decoration:none href=https://github.com/bruhtus/resume target=_blank rel="noreferrer noopener">Robertus Chris</a>
<span>&#183;</span>
<a style=text-decoration:none href=https://bruhtus.github.io/index.xml target=_blank rel="noreferrer noopener">RSS Feed</a>
<span>&#183;</span>
Based on <a style=text-decoration:none href=https://github.com/koirand/pulp/ target=_blank rel="noreferrer noopener">pulp</a> and <a style=text-decoration:none href=https://github.com/adityatelange/hugo-PaperMod target=_blank rel="noreferrer noopener">papermod</a> theme
</p>
</footer>
<button onclick=topFunction() id=myBtn title="Go to top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d0d0d0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 15l-6-6-6 6"/></svg>
</button>
<script>var mybutton=document.getElementById("myBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://bruhtus.github.io/js/custom.js></script>
</body>
</html>