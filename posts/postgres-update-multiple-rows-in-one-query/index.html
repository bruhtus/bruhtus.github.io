<!doctype html><html>
<head>
<title>
Postgresql Update Multiple Rows with One Query
</title>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Robertus Chris">
<link rel="shortcut icon" type=image/x-icon href=https://bruhtus.github.io/img/favicon.ico>
<link rel=stylesheet href=https://bruhtus.github.io/style.min.4f970aa135421035a71bdc9bbd750aa2cfbe0ddb080ab1ec5db4173f45494cad.css integrity="sha256-T5cKoTVCEDWnG9ybvXUKos++DdsICrHsXbQXP0VJTK0=">
<link disabled rel=stylesheet href=https://bruhtus.github.io/style-dark.min.0a647fb6c07e04b77b54fa0515d0a683d39ecdb251dba960fe1f966f7ff36fc2.css media="(prefers-color-scheme: dark)" integrity="sha256-CmR/tsB+BLd7VPoFFdCmg9OezbJR26lg/h+Wb3/zb8I=">
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.8.1/css/all.css integrity=sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf crossorigin=anonymous>
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css2?family=Bitter:wght@300&family=EB+Garamond&family=PT+Sans&family=Sura&family=Zilla+Slab&family=Inconsolata&family=Libre+Baskerville&display=swap" rel=stylesheet>
<link rel=stylesheet href=https://bruhtus.github.io/css/custom.css>
<meta property="og:title" content="Postgresql Update Multiple Rows with One Query">
<meta property="og:description" content="A Brief Intro Have you ever wondering how to update multiple rows with one query? Let&rsquo;s say you want to change value on table A where the name is anu on year 2019, 2020, and 2021.
Rather than doing 3 query with different WHERE statement, we can do that with one query. Without further ado, let&rsquo;s go straight to it!
FROM statement Postgresql has FROM clause in UPDATE statement which let us use columns on other table, it use the same syntax as FROM clause in SELECT statement.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://bruhtus.github.io/posts/postgres-update-multiple-rows-in-one-query/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2023-06-01T15:01:42+07:00">
<meta property="article:modified_time" content="2023-06-01T15:01:42+07:00">
<meta itemprop=name content="Postgresql Update Multiple Rows with One Query">
<meta itemprop=description content="A Brief Intro Have you ever wondering how to update multiple rows with one query? Let&rsquo;s say you want to change value on table A where the name is anu on year 2019, 2020, and 2021.
Rather than doing 3 query with different WHERE statement, we can do that with one query. Without further ado, let&rsquo;s go straight to it!
FROM statement Postgresql has FROM clause in UPDATE statement which let us use columns on other table, it use the same syntax as FROM clause in SELECT statement."><meta itemprop=datePublished content="2023-06-01T15:01:42+07:00">
<meta itemprop=dateModified content="2023-06-01T15:01:42+07:00">
<meta itemprop=wordCount content="268">
<meta itemprop=keywords content="Notes,Postgresql,"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<h1>Postgresql Update Multiple Rows with One Query</h1>
<header>
<div class=cd>
<h2><a style=text-decoration:none class=cd href=https://bruhtus.github.io/posts>cd ..</a> || <a style=text-decoration:none class=cd href=https://bruhtus.github.io/>cd</a></h2>
</div>
</header>
<p class=date>
June 1, 2023
<span>&#183;</span>
2 mins
<span>&#183;</span>
Robertus Chris
</p>
<div id=tags>
<ul>
<li><a style=text-decoration:none href=https://bruhtus.github.io/tags/notes/>Notes</a></li>
<li><a style=text-decoration:none href=https://bruhtus.github.io/tags/postgresql/>Postgresql</a></li>
</ul>
</div>
<div class=toc>
<details>
<summary>
<div class=details>Table of Contents</div>
</summary>
<blockquote><ul><li>
<a style=text-decoration:none href=#a-brief-intro aria-label="A Brief Intro">A Brief Intro</a></li><li>
<a style=text-decoration:none href=#from-statement aria-label="FROM statement">FROM statement</a></li><li>
<a style=text-decoration:none href=#references aria-label=References>References</a></li></ul>
</blockquote>
</details>
</div>
<div id=contentBody>
<h2 id=a-brief-intro>A Brief Intro</h2>
<p>Have you ever wondering how to update multiple rows with one query? Let&rsquo;s say
you want to change value on table A where the name is <code>anu</code> on year 2019,
2020, and 2021.</p>
<p>Rather than doing 3 query with different <code>WHERE</code> statement, we can do that
with one query. Without further ado, let&rsquo;s go straight to it!</p>
<h2 id=from-statement>FROM statement</h2>
<p>Postgresql has <code>FROM</code> clause in <code>UPDATE</code> statement which let us use columns on
other table, it use the same syntax as <code>FROM</code> clause in <code>SELECT</code> statement.</p>
<p>We can combine <code>FROM</code> clause with <code>VALUES</code> expression. <code>VALUES</code> in postgresql
let us create a constant table which means we can generate a table with
constant values that can be used in a query without having to actually create
and populate the table on disk.</p>
<p>Now here&rsquo;s an example case:<br>
Let&rsquo;s say we need to update the <code>price</code> rows on <code>area</code> tokyo at table
<code>meat</code> with year <code>2019</code>, <code>2020</code>, and <code>2021</code>. We can make the query like this:</p>
<div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=color:#6ab825;font-weight:700>UPDATE</span><span style=color:#666> </span>meat<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>SET</span><span style=color:#666> </span>price<span style=color:#666> </span>=<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>new</span>.price<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>FROM</span><span style=color:#666> </span>(<span style=color:#6ab825;font-weight:700>values</span><span style=color:#666>
</span><span style=color:#666>    </span>(<span style=color:#3677a9>6942</span>,<span style=color:#666> </span><span style=color:#3677a9>2019</span>),<span style=color:#666>
</span><span style=color:#666>    </span>(<span style=color:#3677a9>69420</span>,<span style=color:#666> </span><span style=color:#3677a9>2020</span>),<span style=color:#666>
</span><span style=color:#666>    </span>(<span style=color:#3677a9>69690</span>,<span style=color:#666> </span><span style=color:#3677a9>2021</span>),<span style=color:#666>
</span><span style=color:#666></span>)<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>AS</span><span style=color:#666> </span><span style=color:#6ab825;font-weight:700>new</span>(price,<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>year</span>)<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>WHERE</span><span style=color:#666> </span>meat.area<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>ILIKE</span><span style=color:#666> </span><span style=color:#ed9d13>&#39;tokyo&#39;</span><span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>AND</span><span style=color:#666> </span>meat.<span style=color:#6ab825;font-weight:700>year</span><span style=color:#666> </span>=<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>new</span>.<span style=color:#6ab825;font-weight:700>year</span><span style=color:#666>
</span><span style=color:#666></span>RETURNING<span style=color:#666> </span>*;<span style=color:#666>
</span></code></pre></div><p>You can change the <code>new</code> in <code>new(price, year)</code> with anything you like.</p>
<p>Another example case:<br>
Let&rsquo;s say we need to update the city&rsquo;s population on specific regencies.
So we need to update data on population column in city table which has
reference to regencies id. We can make the query like this:</p>
<div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=color:#6ab825;font-weight:700>UPDATE</span><span style=color:#666> </span>city<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>SET</span><span style=color:#666> </span>population<span style=color:#666> </span>=<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>new</span>.population<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>FROM</span><span style=color:#666>
</span><span style=color:#666></span>regencies,<span style=color:#666>
</span><span style=color:#666></span>(<span style=color:#6ab825;font-weight:700>values</span><span style=color:#666>
</span><span style=color:#666>    </span>(<span style=color:#ed9d13>&#39;city 1&#39;</span>,<span style=color:#666> </span><span style=color:#3677a9>69420</span>),<span style=color:#666>
</span><span style=color:#666>    </span>(<span style=color:#ed9d13>&#39;city 2&#39;</span>,<span style=color:#666> </span><span style=color:#3677a9>6969</span>)<span style=color:#666>
</span><span style=color:#666></span>)<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>AS</span><span style=color:#666> </span><span style=color:#6ab825;font-weight:700>new</span>(regency,<span style=color:#666> </span>population)<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>WHERE</span><span style=color:#666> </span>regencies.id<span style=color:#666> </span>=<span style=color:#666> </span>city.regency_id<span style=color:#666>
</span><span style=color:#666></span><span style=color:#6ab825;font-weight:700>AND</span><span style=color:#666> </span>regencies.regency<span style=color:#666> </span><span style=color:#6ab825;font-weight:700>ilike</span><span style=color:#666> </span><span style=color:#6ab825;font-weight:700>new</span>.regency<span style=color:#666>
</span><span style=color:#666></span>RETURNING<span style=color:#666> </span>regencies.regency,<span style=color:#666> </span>city.population;<span style=color:#666>
</span></code></pre></div><blockquote>
<p>The <code>RETURNING</code> clause is optional, it&rsquo;s a way to check if we really changed the
right rows or not. The <code>ILIKE</code> clause is an expression for insensitive case.</p>
</blockquote>
<p>Alright, that&rsquo;s it. See you next time!</p>
<h2 id=references>References</h2>
<ul>
<li><a href=https://stackoverflow.com/a/18799497 target=_blank rel="noreferrer noopener">Stackoverflow example</a>
.</li>
<li><a href=https://www.postgresql.org/docs/current/sql-update.html target=_blank rel="noreferrer noopener">Postgresql update
documentation</a>
.</li>
<li><a href=https://www.postgresql.org/docs/current/sql-values.html target=_blank rel="noreferrer noopener">Postgresql values
documentation</a>
.</li>
</ul>
</div>
<footer>
<p>
&copy; 2020-present <a style=text-decoration:none href=https://github.com/bruhtus/resume target=_blank rel="noreferrer noopener">Robertus Chris</a>
<span>&#183;</span>
<a style=text-decoration:none href=https://bruhtus.github.io/index.xml target=_blank rel="noreferrer noopener">RSS Feed</a>
<span>&#183;</span>
Based on <a style=text-decoration:none href=https://github.com/koirand/pulp/ target=_blank rel="noreferrer noopener">pulp</a> and <a style=text-decoration:none href=https://github.com/adityatelange/hugo-PaperMod target=_blank rel="noreferrer noopener">papermod</a> theme
</p>
</footer>
<button onclick=topFunction() id=myBtn title="Go to top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#d0d0d0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 15l-6-6-6 6"/></svg>
</button>
<script>var mybutton=document.getElementById("myBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://bruhtus.github.io/js/custom.js></script>
</body>
</html>