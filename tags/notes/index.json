[{"ref":"https://bruhtus.github.io/posts/pointer-in-c-warehouse-analogy/","title":"Pointer in C: Warehouse Analogy","section":"posts","tags":["Notes","C"],"date":"2025.11.05","body":"At the time of writing this post, i am still learning about C programming language, and one of the topics about C programming language is \u0026ldquo;pointer\u0026rdquo;. I know that there\u0026rsquo;s a lot of analogy about pointers out there, one of the common one is about house and house address, but i want to share the analogy that help me understand about pointer.\nImagine there\u0026rsquo;s a company called RAM and those company business is renting out warehouses. And then we, as the customer, want to rent one of their warehouses.\nWhen we rent the warehouse, we got the following item:\n The warehouse key. The keychain with warehouse information on the key.  Before we go further, think of the \u0026ldquo;warehouse\u0026rdquo; as data storage (a.k.a memory), the \u0026ldquo;warehouse key\u0026rdquo; as the pointer in C, and the \u0026ldquo;keychain\u0026rdquo; as the address that we save in those pointer. We can think of the \u0026ldquo;keychain\u0026rdquo; as the value of the \u0026ldquo;key\u0026rdquo;.\nIf we want to get \u0026ldquo;something\u0026rdquo; inside the warehouse, we need to use the \u0026ldquo;key\u0026rdquo; to open the warehouse. We can think of \u0026ldquo;opening\u0026rdquo; the warehouse using the \u0026ldquo;key\u0026rdquo; as dereferencing a pointer, and the effect of \u0026ldquo;opening\u0026rdquo; the warehouse is that we got \u0026ldquo;something\u0026rdquo; from inside the warehouse.\nNow, let\u0026rsquo;s say that we have a \u0026ldquo;key\u0026rdquo; but we don\u0026rsquo;t have the \u0026ldquo;keychain\u0026rdquo;, how do we know which warehouse we are supposed to open? This situation will cause confusion for us, and it\u0026rsquo;s also similar for the computer. This situation can be illustrated with this C code:\nint main(void) { int *p; *p = 69; return 0; } The above code means that we are trying to put 69 into the warehouse, but we did not give which warehouse we are supposed to use. If we try running those code (after we compiled it), we will get segmentation fault error, which basically means that the computer can not access the memory because there\u0026rsquo;s no information about the memory that the computer supposed to use.\nTo solve those problem, we can give information about which \u0026ldquo;warehouse\u0026rdquo; to use like this:\nint main(void) { int i; int *p; p = \u0026amp;i; *p = 69; return 0; } The above code means that we put the address of warehouse i in our \u0026ldquo;keychain\u0026rdquo; so that we know which warehouse to use, and we can put 69 in our warehouse. This is also the case with computer, now the computer is not confused anymore and won\u0026rsquo;t throw segmentation fault error.\nThere\u0026rsquo;s also a case with dangling pointer, which basically means that the \u0026ldquo;key\u0026rdquo; and the \u0026ldquo;keychain\u0026rdquo; is exist but the warehouse is already demolished. So when we are trying to \u0026ldquo;open\u0026rdquo; the warehouse, we can\u0026rsquo;t find the specified warehouse from the information on the \u0026ldquo;keychain\u0026rdquo; and here comes another confusion. I will leave it up to you to try out dangling pointer and other pointer case.\nAlright, that\u0026rsquo;s it. See you next time!\n"},{"ref":"https://bruhtus.github.io/posts/difference-between-i++-and-++i-in-c/","title":"Difference Between i++ and ++i in C","section":"posts","tags":["Notes","C"],"date":"2025.11.04","body":"A Brief Explanation Let\u0026rsquo;s say we have int i = 0;, and imagine there\u0026rsquo;s a temporary object (rvalue?) to store the result of i + 1 for the ++ operator.\n Object is an area of memory that is used by our program, and temporary object in here means that the object has a temporary duration and will be deleted when the containing full expression ends.\nFull expression here means:\n The complete expression that forms an expression statement (with terminating semicolon (;) at the end). One of the controlling expression if, switch, while, for, or do-while statement. The expression of an initializer (like int i = 0;). return statement.   This is what probably happen if we use i++ without assigned the result to another variable:\n// i++; tmp = i; i = i + 1; This is what probably happen if we use ++i without assigned the result to another variable:\n// ++i; i = i + 1; tmp = i; This is what probably happen if we use i++ when assigned the result to variable j:\n// int j = i++; tmp = i; j = tmp; i = i + 1; This is what probably happen if we use ++i when assigned the result to variable j:\n// int j = ++i; i = i + 1; tmp = i; j = tmp; The only difference between i++ and ++i is when we use the value of the operation in the same statement, like int j = ++i.\nP.S:\nAt the time of writing this post, i am still learning about C, so this illustration might be wrong. Please let me know if there are a better illustration about this.\ni++ or ++i in For Loop When using either i++ or ++i in for-loop like this:\nint i; for (i = 0; i \u0026lt; 5; i++) printf(\u0026#34;%d\\n\u0026#34;, i); for (i = 0; i \u0026lt; 5; i++) printf(\u0026#34;%d\\n\u0026#34;, i); Both of them will operate identically because the increment of i and the print statement is in different line. It\u0026rsquo;s like we are using i++ or ++i without any assignment like this:\nint i = 0; i++; ++i; printf(\u0026#34;%d\\n\u0026#34;, i); Side Note Please keep in mind that operation i++ and ++i is also prone to integer overflow.\nHere an overflow example:\n#include \u0026lt;stdio.h\u0026gt;#include \u0026lt;limits.h\u0026gt; int main(void) { unsigned int i = UINT_MAX; printf(\u0026#34;before increment i: %d\\n\u0026#34;, i); i++; printf(\u0026#34;after increment i: %d\\n\u0026#34;, i); return 0; } In the example above, as we store the maximum value of unsigned integer in i and when we increase the value of i, the result would be 0 because the value is more than the maximum value of unsigned integer, so it result in overflow.\nReferences  Stackoverflow about difference between i++ and ++i . About temporary object . About integer overflow . Unsigned integers overflow . Cppreference object lifetime . Cppreference statements .  "},{"ref":"https://bruhtus.github.io/posts/flashing-skeletyl-keyboard-with-miryoku-layout/","title":"Flashing Skeletyl Keyboard With Miryoku Layout","section":"posts","tags":["Notes","Linux"],"date":"2025.07.13","body":"Setup Miryoku in QMK Disclaimer:\nBy the time of writing this post, there\u0026rsquo;s a breaking change in QMK that remove user keymaps, including miryoku. And miryoku QMK haven\u0026rsquo;t porting it\u0026rsquo;s config in the new QMK userspace. So this section might become obsolete in the future. For reference: https://github.com/manna-harbour/miryoku/discussions/287 First thing we need to do is to setup QMK. We can check the QMK documentation below:\nhttps://github.com/qmk/qmk_firmware/blob/master/docs/newbs_getting_started.md To check if QMK already installed on linux, we can use this command:\ncommand -v qmk if there\u0026rsquo;s any output, it means QMK is already installed. If there\u0026rsquo;s no output, try again.\nAfter QMK is installed, we need to setup QMK with this command:\nqmk setup By default, the installation directory will be on our home directory. If we don\u0026rsquo;t want to put the QMK installation on my home directory, we can add -H flag to move the installation directory to somewhere else, like this:\nqmk setup -H all-repos/qmk_firmware If the setup already finished, try running:\nqmk doctor and see if there\u0026rsquo;s any issue with the installation.\n If you see a warning about 50-qmk.rules, we might to copy 50-qmk.rules to /etc/udev/rules.d/. Like this: cp path/to/50-qmk.rules /etc/udev/rules.d\n After that, we need to change our working directory qmk_firmware. In qmk_firmware directory, we need to add miryoku_qmk fork like this:\ngit remote add miryoku_qmk https://github.com/manna-harbour/miryoku_qmk.git git fetch miryoku_qmk git checkout --track miryoku_qmk/miryoku And then we need to merge miryoku with QMK master branch like this:\ngit checkout -b miryoku-merge-master git revert --no-edit `git log --grep=\u0026#39;^\\[miryoku-github\\]\u0026#39; --pretty=\u0026#39;format:%H\u0026#39; | tr \u0026#39;\\n\u0026#39; \u0026#39; \u0026#39;` git fetch origin git merge origin/master and solve all conflict.\nAfter that, we need to copy layouts/community/split_3x5_3/manna-harbour_miryoku/ from miryoku branch into keyboards/bastardkb/skeletyl/keymaps/ in miryoku-merge-master branch. We also need to copy users/manna-harbour_miryoku/ from miryoku branch to users/ in miryoku-merge-master branch.\nAfter that, we need to run this command:\nmake git-submodule Next, we need to make sure that we can compile the miryoku layout by running this command:\nqmk compile -c -kb bastardkb/skeletyl/v2/splinky_3 -km manna-harbour_miryoku -e MIRYOKU_ALPHAS=QWERTY -e MIRYOKU_LAYERS=FLIP -e MIRYOKU_NAV=INVERTEDT  I prefer to use qwerty layout, so i add flag -e MIRYOKU_ALPHAS=QWERTY. Also my unit using rp2040, that\u0026rsquo;s why i\u0026rsquo;m using splinky_3. I\u0026rsquo;m not sure the difference between splinky_2 and splinky_3, and the reason i\u0026rsquo;m using splinky_3 instead of splinky_2 is because i think splinky_3 is the latest version of splinky variant. I prefer to use space on the right side, hence why i put flag -e MIRYOKU_LAYERS=FLIP to flip the base layer thumb keys and sub layers between right and left hands. I also prefer using arrow key in inverted T model, like asdw in fps game, hence why i put flag -e MIRYOKU_NAV=INVERTEDT.\n If there\u0026rsquo;s no error, we can go into the next section. If there\u0026rsquo;s some error, we might need to adjust a few things. Check this discussion and see if this changes fix the error:\n https://github.com/manna-harbour/miryoku/discussions/361  https://github.com/manna-harbour/miryoku/discussions/361#discussioncomment-12243200   Flashing Skeletyl Keyboard The first thing we need to do is make our keyboard enter bootloader mode. In skeletyl keyboard, we can use the update button at the bottom of the keyboard. For more info, we can check this guide:\nhttps://docs.bastardkb.com/fw/flashing.html  Because we using new firmware, we can flash both side with the same firmware.\n After our keyboard enter bootloader mode, we need to mount our micro controller to our linux system. We can use lsblk to find out our micro controller partition name and mount those partition. For example, if our micro controller partition name is sda1, we can use this command to mount our micro controller partition:\nsudo mount /dev/sda1 /mnt After that, we can run this command to flash our micro controller with firmware that has miryoku layout in it:\nqmk flash -c -kb bastardkb/skeletyl/v2/splinky_3 -km manna-harbour_miryoku -e MIRYOKU_ALPHAS=QWERTY -e MIRYOKU_LAYERS=FLIP -e MIRYOKU_NAV=INVERTEDT If there\u0026rsquo;s no error, we can use our skeletyl keyboard with miryoku layout after the flashing process finish. If there\u0026rsquo;s an error, you might want to take a look at miryoku discussion or issue on github.\nIf the skeletyl keyboard is not usable after booting up the computer, we can add #define USB_VBUS_PIN GP19 in file keyboards/bastardkb/skeletyl/v2/splinky_3/config.h. Defining USB_VBUS_PIN will allow us to tell the controller whether it\u0026rsquo;s master or slave right away, resulting in immediate boot for both sides. After defining USB_VBUS_PIN, we can flashing both side of the keyboard again using the command above.\nAll right, that\u0026rsquo;s it. See you next time!\nSide Note Currently the right side of miryoku qwerty layout using hjkl' instead of hjkl;, so you might be surprised the first time using miryoku qwerty layout. There\u0026rsquo;s a plan to customize that, but as of writing this post, it\u0026rsquo;s still work in progress. You can check this discussion to see the progress:\nhttps://github.com/manna-harbour/miryoku/discussions/85 References  Miryoku reference manual  Miryoku build guide  Miryoku breaking change QMK discussion  Skeletyl flashing firmware guide  Github issue QMK rp2040 not usable from boot  Skeletyl USB VBUS PIN for splinky controllers   "},{"ref":"https://bruhtus.github.io/posts/git-rebase-chained-branch/","title":"Git Rebase Chained Branch","section":"posts","tags":["Notes","Git"],"date":"2025.04.18","body":"Let\u0026rsquo;s say we try to develop a feature B, but those feature need feature A which haven\u0026rsquo;t merged already. So, to prevent the diff changes getting larger, we create new branch to develop feature B. And then, in the middle of development of feature B, the branch that contains feature A got merged into main branch and all the commit from feature A got squashed into one commit. And when we try to rebase the feature B branch with main branch, we got a conflict from a commit which previously in feature A branch.\nTo make the situation clear, let\u0026rsquo;s take a look at this:\nBefore: A---B (main branch) \\ C---D (feature-A branch) \\ E---F (feature-B branch) After: A---B---G (main branch, with G commit as squashed C and D commit) \\ E---F (feature-B branch) The steps to make the conflict scenario are:\nmkdir git-test cd git-test git init -b main echo \u0026#39;first\u0026#39; \u0026gt; something git add something git commit -m \u0026#39;first\u0026#39; echo \u0026#39;second\u0026#39; \u0026gt;\u0026gt; something git commit -am \u0026#39;second\u0026#39; git checkout -b feature-A echo \u0026#39;third\u0026#39; \u0026gt;\u0026gt; something git commit -am \u0026#39;third\u0026#39; echo \u0026#39;fourth\u0026#39; \u0026gt;\u0026gt; something git commit -am \u0026#39;fourth\u0026#39; git checkout -b feature-B echo \u0026#39;fifth\u0026#39; \u0026gt;\u0026gt; something git commit -am \u0026#39;fifth\u0026#39; echo \u0026#39;sixth\u0026#39; \u0026gt;\u0026gt; something git commit -am \u0026#39;sixth\u0026#39; git checkout main git merge --squash feature-A git commit --no-edit git checkout feature-B git rebase main  To get out from the conflict, we can use git rebase --abort.\n Now, to prevent the conflict, instead of using git rebase, we can use git rebase --fork-point --onto like this:\ngit rebase --fork-point --onto main feature-A feature-B Flag --fork-point is to find the common commit point from main branch with feature-A branch and flag --onto is to change the parent commit from feature-A branch to main branch and apply the commit that exist in feature-B branch but not in feature-A branch \u0026ldquo;onto\u0026rdquo; main branch commit.\nNow, let\u0026rsquo;s say we have more than one branch that depends on feature A branch. Do we need to do git rebase --fork-point --onto ... multiple time? Well, fortunately there\u0026rsquo;s a flag --update-refs that will automatically do that for us.\nTo make the situation clear, let\u0026rsquo;s take a look at this:\nBefore: A---B (main branch) \\ C---D (feature-A branch) \\ E---F (feature-B branch) \\ G---H (feature-C branch) \\ I---J (feature-D branch) After: A---B---K (main branch, with K commit as squashed C and D commit) \\ E---F (feature-B branch) \\ G---H (feature-C branch) \\ I---J (feature-D branch) To use --update-refs, we need to rebase the top of the chained branch, which in the case above is feature-D branch. With that in mind, we can use this command:\ngit rebase --update-refs --onto main feature-A feature-D --onto main feature-A feature-D means rebase the range of commits in feature-A branch until feature-D branch on top of commits from main branch. We use feature-A because it\u0026rsquo;s the base branch for our chained branch and feature-D because it\u0026rsquo;s the top of the chained branch.\n We don\u0026rsquo;t need to use --fork-point to guess which common commit in all those branch because --update-refs already do that for us.\n Now, what should we do if we merge feature-B branch? The situation would be like this:\nBefore: A---B---K (main branch, with K commit as squashed C and D commit) \\ E---F (feature-B branch) \\ G---H (feature-C branch) \\ I---J (feature-D branch) After: A---B---K---L (main branch, with L commit as squashed E and F commit) \\ G---H (feature-C branch) \\ I---J (feature-D branch) We can use the same command as above but, instead of using feature-A, we use feature-B instead, like this:\ngit rebase --update-refs --onto main feature-B feature-D Next scenario, let\u0026rsquo;s say we create new branch feature-E from feature-D branch and add new commit in it. And then, we got some feedback for feature-C branch so we need to add new commit. The situation would be like this:\nBefore: A---B---K---L (main branch, with L commit as squashed E and F commit) \\ G---H---O (feature-C branch) \\ I---J (feature-D branch) \\ M---N (feature-E branch) With the situation above, we can checkout into feature-E branch or the top of the chained branch and use --update-refs like this:\ngit rebase --update-refs feature-C Alright, that\u0026rsquo;s it. See you next time!\nSide Note We can push all those branch as an atomic operation, which means, if one of the branch failed to push into a remote branch, the others branch won\u0026rsquo;t update the remote branch too. To do that, we can use flag --atomic in git push like this:\ngit push --atomic origin feature-C feature-D feature-E Please keep in mind that if you\u0026rsquo;re rebasing the git branch you want to push, you might need flag --force-with-lease in git push, like this:\ngit push --force-with-lease --atomic origin feature-C feature-D feature-E References  Stackoverflow git rebase \u0026ndash;onto answer . Women on rails git rebase \u0026ndash;onto an overview . Stackoverflow git rebase \u0026ndash;fork-point answer . Git rebase \u0026ndash;update-refs blog post   "},{"ref":"https://bruhtus.github.io/posts/use-arch-linux-vm-for-linux-kernel-testing/","title":"Use Arch Linux VM for Linux Kernel Testing","section":"posts","tags":["Notes","Linux"],"date":"2025.03.30","body":"A Brief Intro Have you wondered \u0026ldquo;how can we test a linux kernel without breaking our linux operating system installation?\u0026rdquo;. One of the method is using virtual machine (VM) and in this post we\u0026rsquo;ll use arch linux in virtual machine to try out different version of linux kernel.\nThere are 2 scenarios that we will discuss on this post:\n Using arch linux VM with arch linux as host system. Using arch linux VM with different linux distro as host system.  We\u0026rsquo;re going to work with 2 systems on 1 machine, so we need to know which command need to run on which machine. For that purpose, we\u0026rsquo;re going to use this indicator to differentiate:\n# @host # for real machine system # @guest # for virtual machine system Arch Linux as Host System The prerequisite for this scenario is that we need to use arch linux on the real machine or host machine we want to install the virtual machine.\nAfter we make sure that the host machine system we have is using arch linux, the first thing we need to do is create a file to store arch linux installation for the virtual machine. We can define how much space we\u0026rsquo;ll allocate to the installation, but in this post we\u0026rsquo;ll use 15G just to be save. To create a file for virtual machine OS installation, we can use this command:\n# @host truncate -s 15g arch-linux-disk.raw We can name the file whatever we want, but in this case, we\u0026rsquo;ll use arch-linux-disk.\nAfter that, we need to create a filesystem volume by formatting the file into ext4 with this command:\n# @host mkfs.ext4 arch-linux-disk.raw And then, we can mount the filesystem partition into /mnt like this (assuming we\u0026rsquo;re not login as root user):\n# @host sudo mount arch-linux-disk.raw /mnt  If your /mnt is occupied, you can use another directory such as vm, like this: sudo mount --mkdir arch-linux-disk.raw vm\n After mounting the filesystem, make sure arch-install-scripts and qemu-base package installed on our system by running this command:\n# @host sudo pacman -S arch-install-scripts qemu-base  arch-install-scripts contains some useful scripts to install arch linux such as pacstrap and arch-chroot. qemu-base is for creating the virtual machine we will use later.\n After those packages installed, we can use this command to install arch linux on arch-linux-disk.raw:\n# @host sudo pacstrap -c /mnt base base-devel vim dhcpcd  flag -c is to use package cache on host system, so we only need to download some out of date packages rather than downloading all the packages. base is a package for basic arch linux installation and base-devel is for packages such as sudo and grep. vim is my editor of choice, so you don\u0026rsquo;t have to install this if you don\u0026rsquo;t want to. dhcpcd is to connect the virtual machine system to the internet.\n After everything installed, we can go into the new filesystem with this command:\n# @host sudo arch-chroot /mnt After that, we can setup password for root user with this command:\n# @guest passwd Also, we can start dhcpcd for internet connection on our virtual machine with this command:\n# @guest systemctl enable --now dhcpcd To exit from the guest filesystem, we can use ctrl-d or exit command. After exit from the guest filesystem, we can unmount the filesystem using this command:\n# @host sudo umount /mnt Use Custom Linux Kernel on QEMU VM Before we spin up our virtual machine, we need to compile the linux kernel.\nFirst thing we need to do is download the linux kernel source code from one of available source on https://web.git.kernel.org/pub/scm/linux/kernel/git . In this post, we will download the source from Linux Torvalds source code. For example, let\u0026rsquo;s say we want to download the source code for tag v6.14, we can use wget like this:\n# @host wget https://web.git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-6.14.tar.gz Or we can just click on the Download link. Or we can clone the repo with this command:\n# @host git clone --depth=1 git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git torvalds-kernel  --depth=1 means that we download 1 commit instead of all the commits. torvalds-kernel is the directory name where we clone the linux kernel source code git repository (instead of naming it linux, we name it torvalds-kernel).\n After we download the linux kernel source code, we can change directory into it. And then, we can create a basic config x86_64 config using this command:\n# @host make x86_64_defconfig And then we need to add config for virtual machine with this command:\n# @host make kvm_guest.config After that, we can compile the linux kernel with this command:\n# @host make -j \u0026lt;n\u0026gt;  \u0026lt;n\u0026gt; is how much threads we use. For example, make -j 8 means we use 8 threads.\n We can change the config with command:\nmake nconfig  Please keep in mind, DO NOT directly edit the .config file. Use make nconfig instead.\n After we finish compiling the linux kernel, we can use that linux kernel in our QEMU virtual machine with this command:\n# @host qemu-system-x86_64 \\  -hda /path/to/arch-linux-disk.raw \\  -m 2g \\  -nographic \\  -kernel /path/to/linux-6.14/arch/x86/boot/bzImage \\  -append \u0026#34;root=/dev/sda rw console=ttyS0 loglevel=5\u0026#34; \\  -enable-kvm \\  -nic user,hostfwd=tcp::2222-:22 For example:\n# @host qemu-system-x86_64 \\  -hda $HOME/.local/state/qemu/kernel-dev-disk.raw \\  -m 2g \\  -nographic \\  -kernel $HOME/.local/state/qemu/linux-6.14-rc5/arch/x86/boot/bzImage \\  -append \u0026#34;root=/dev/sda rw console=ttyS0 loglevel=5\u0026#34; \\  -enable-kvm \\  -nic user,hostfwd=tcp::2222-:22 Here\u0026rsquo;s a brief explanation of each flags:\n -hda is to use a file as a hard disk. -hda is equivalent to sda partition, -hdb is equivalent to sdb, and so on. -m is RAM size for the virtual machine. -nographic make QEMU run on the terminal instead of graphical window. -kernel is to define the custom kernel we\u0026rsquo;ll use in virtual machine. -append is to define kernel parameters we\u0026rsquo;ll be using. We can\u0026rsquo;t use this without -kernel flag. For more info about kernel parameters, we can take a look the kernel docs . -enable-kvm is to enable KVM virtualization support (if available). -nic is to forward internet connection of host machine to virtual machine.  To exit the virtual machine in nographic mode, we can use ctrl-a x.\nAnother Linux Distro as Host System If we use another linux distro, we need to install arch linux in virtual machine from scratch. You can take a look at my previous post for how to install arch linux using QEMU. Please keep in mind that you need to install qemu and vncviewer package on your host system.\nUse Custom Linux Kernel on QEMU VM After installing arch linux in virtual machine, we need to compile the linux kernel based on the kernel config in the virtual machine.\nWe can run the virtual machine with shared directory with this command:\n# @host qemu-system-x86_64 \\  -m 2g \\  -enable-kvm \\  -fsdev local,id=fs1,path=/path/to/linux-kernel,security_model=none \\  -device virtio-9p-pci,fsdev=fs1,mount_tag=shared_directory \\  -nic user,hostfwd=tcp::2222-:22 \\  \u0026lt;qemu-image\u0026gt; For example:\n# @host qemu-system-x86_64 \\  -m 2g \\  -enable-kvm \\  -fsdev local,id=fs1,path=$HOME/.local/state/qemu/linux-6.14,security_model=none \\  -device virtio-9p-pci,fsdev=fs1,mount_tag=shared_directory \\  -nic user,hostfwd=tcp::2222-:22 \\  arch-linux-img  Please don\u0026rsquo;t forget to add the shared directory in /etc/fstab.\n In the example above, we\u0026rsquo;re using the linux kernel source code directory as a shared directory.\nInside the virtual machine, we need to copy the kernel config into the shared directory. Assuming our shared directory is in /home/user/shared, we can use this command:\n# @guest zcat /proc/config.gz \u0026gt; /home/user/shared/.config After we got the config, we need to adjust the config so that we only compile linux kernel with the module we need rather than compiling with all module enabled. This can save time to compile the linux kernel. To do that we can use this command:\n# @guest make localmodconfig Sometimes, there are new features or new config parameters in the source code repo and we need to confirm if we want to add those new config parameters in our .config file or not. To reduce the amount of confirmation we need to make, we can use this command:\n# @guest make olddefconfig Also, we need to add a config for virtual machine with this command:\n# @guest make kvm_guest.config If we want to edit some config parameters, we can use:\n# @guest make nconfig After that, we can shutdown the virtual machine and compile the linux kernel with this command:\n# @host make -j \u0026lt;n\u0026gt;  \u0026lt;n\u0026gt; is how much threads we use. For example, make -j 8 means we use 8 threads.\n And then, we need to compile the linux kernel modules with this command:\n# @host make modules After we compile both linux kernel and the modules, we can turn on the virtual machine again and put the modules into /lib/modules/\u0026lt;kernel-name\u0026gt; in the virtual machine with this command:\n# @guest sudo make modules_install And then, we need to copy the linux kernel into /boot with this command:\n# @guest sudo cp /home/user/shared/arch/x86/boot/bzImage /boot/vmlinuz-\u0026lt;name\u0026gt;  We can use any \u0026lt;name\u0026gt; we want, but to make it easier to organize, i suggest you use the same \u0026lt;name\u0026gt; in the following step.\n After that, we need to copy the default mkinitcpio preset like this:\n# @guest sudo cp /etc/mkinitcpio.d/linux.preset /etc/mkinitcpio.d/linux-\u0026lt;name\u0026gt;.preset And then, we need to replace ALL_kver, default_image, and fallback_image with the \u0026lt;name\u0026gt; we assign before. For example, let\u0026rsquo;s say we use torvalds-vm as \u0026lt;name\u0026gt;, we can use something like this:\n... ALL_kver=\u0026quot;/boot/vmlinuz-torvalds-vm\u0026quot; ... default_image=\u0026quot;/boot/initramfs-torvalds-vm.img\u0026quot; ... fallback_image=\u0026quot;/boot/initramfs-torvalds-vm-fallback.img\u0026quot; After that, we need to generate initramfs using this command:\n# @guest sudo mkinitcpio -p linux-\u0026lt;name\u0026gt; Assuming we\u0026rsquo;re using grub as our bootloader in a virtual machine, we need to update the grub config like this:\n# @guest sudo grub-mkconfig -o /boot/grub/grub.cfg Now, we need to reboot the virtual machine and check if everything works fine. If we check on grub \u0026ldquo;Advanced options for Arch Linux\u0026rdquo;, we should we able to see our custom linux kernel.\nAlright, that\u0026rsquo;s it. See you next time!\nReferences  Create an ArchLinux image for kernel testing  FLUSP Kernel Compilation and Installation   "},{"ref":"https://bruhtus.github.io/posts/install-arch-linux-on-virtual-machine/","title":"Install Arch Linux on Virtual Machine","section":"posts","tags":["Notes","Linux"],"date":"2025.03.02","body":"A Brief Intro In this post, we\u0026rsquo;ll install arch linux on virtual machine with QEMU and add a shared directory between host machine and virtual machine.\nBefore we start, make sure to install QEMU on your system. If your system using arch linux too, we can install qemu-base and tigervnc package. tigervnc package for viewing the virtual machine from QEMU. We will be using SeaBIOS, which is legacy BIOS implementation and the default BIOS on QEMU (at the time of writing this post).\nThis post assume that you use ext4 filesystem format. If you use another file format, like btrfs, you might need to use different configuration.\nWe\u0026rsquo;re going to work with 2 systems on 1 machine, so we need to know which command need to run on which machine. For that purpose, we\u0026rsquo;re going to use this indicator to differentiate:\n# @host # for real machine system # @guest # for virtual machine system QEMU Disk Image The first thing we need to do is to create a disk image. We can do that with this command:\n# @host qemu-img create -f qcow2 \u0026lt;image-path\u0026gt; 15g  qcow2 is the current QEMU image format, and one of the benefit of it is that it will increase the image size based on the virtual machine usage with the limit being the image size given when creating the image. \u0026lt;image-path\u0026gt; is where we store the image. For example: ~/arch-linux-qemu. 15g is the image size.  Installation The first thing we need to do is download the arch linux ISO on the download page .\nAfter that, we can use this command:\n# @host qemu-system-x86_64 -enable-kvm -cdrom \u0026lt;path-to-arch-linux-ISO\u0026gt;.iso -boot order=d -drive file=\u0026lt;image-path\u0026gt; -m 2g  -enable-kvm is to enable full virtualization using KVM. Our machine might not support KVM, so make sure we have KVM support when using this flag. We can read the arch wiki for the instruction. -cdrom \u0026lt;path-to-arch-linux-ISO\u0026gt;.iso is to use the file as CD-ROM image. -boot order=d is to specify that we want to boot from CD-ROM first. -drive file=\u0026lt;image-path\u0026gt; is to specify the disk image to use as the drive on the system. Image path should be a full path like $HOME/arch-linux-img -m 2g is to specify the RAM to use in the virtual machine.  Mostly we can follow the arch linux installation guide , but be careful of the partition. Because we will use the default QEMU BIOS, which is a legacy BIOS, we need to partition the drive with legacy BIOS in mind. We can check on the partition example layout on arch wiki . For this post, we\u0026rsquo;ll use BIOS/GPT layout to not deviate too much from the UEFI/GPT layout.\nIf after running the command above, the virtual machine is not automatically appear, we can use command:\n# @host vncviewer :\u0026lt;port\u0026gt; Make sure to install tigervnc or something similar before running the command. We can get the port from the QEMU command above. For example:\n# @host VNC server running on ::1:5900 5900 is the port we want.\nAfter inside the virtual machine, you can follow the usual arch linux installation guide. To be able to use host machine internet connection, we might want to install dhcpcd in the pacstrap step, like this:\n# @guest pacstrap -K /mnt base linux linux-firmware dhcpcd and enable it after arch-chroot like this:\n# @guest systemctl enable dhcpcd The important part is the drive partition, so we\u0026rsquo;ll skip into the partition part.\nPersonally, i don\u0026rsquo;t really need swap on my virtual machine so in this post we\u0026rsquo;ll only make 2 partition:\n BIOS boot partition (1 MB) with partition type BIOS boot. root partition (the rest of storage) with partition type linux root (x86-64).  We can use cfdisk /dev/\u0026lt;drive\u0026gt; to partition our drive. To look what our drive name is, we can use lsblk command. For example:\n# @guest cfdisk /dev/sda After the partition, we need to format the root partition to ext4 with this command:\n# @guest mkfs.ext4 /dev/\u0026lt;root-partition\u0026gt; for example:\n# @guest mkfs.ext4 /dev/sda2 After that, we can mount the root partition with this command:\n# @guest mount /dev/\u0026lt;root-partition\u0026gt; /mnt for example:\n# @guest mount /dev/sda2 /mnt After that we can follow the rest of the arch linux installation guide until we need to install the bootloader.\nFor this post, we\u0026rsquo;ll use grub2 as our bootloader. First, we need to install grub with this command (after running arch-chroot):\n# @guest pacman -S grub After grub installed, we can use this command to install the bootloader:\n# @guest grub-install --target=i386-pc /dev/\u0026lt;drive-name\u0026gt; keep in mind that we need to provide the drive name, not the partition name. For example:\n# @guest grub-install --target=i386-pc /dev/sda After that, we need to generate the grub config with this command:\n# @guest grub-mkconfig -o /boot/grub/grub.cfg To run the virtual machine, we can use this command:\n# @host qemu-system-x86_64 -enable-kvm -nic user,hostfwd=tcp::2222-:22 -m 2g -smp cores=4,cpus=4 \u0026lt;image-path\u0026gt; If we want to add shared directory between virtual machine and host machine, we can use -fsdev and -device like this:\n# @host qemu-system-x86_64 -enable-kvm -nic user,hostfwd=tcp::2222-:22 -fsdev local,id=fs1,path=\u0026lt;host-shared-directory-path\u0026gt;,security_model=none -device virtio-9p-pci,fsdev=fs1,mount_tag=\u0026lt;mount_tag\u0026gt; -m 2g -smp cores=4,cpus=4 \u0026lt;image-path\u0026gt; and then add to /etc/fstab like this:\n... \u0026lt;mount_tag\u0026gt; \u0026lt;mounting-path-on-virtual-machine\u0026gt; 9p uid=xxxx,gid=xxxx,trans=virtio 0 0 Let\u0026rsquo;s say we have \u0026lt;mount_tag\u0026gt; as shared_directory and we want to mount it on /home/user/shared. Also, to get the uid and gid we can use id \u0026lt;user\u0026gt;, for example id bruhtus. Let\u0026rsquo;s assume the uid and gid of the user is 1000. We can use the command like this:\n# @host qemu-system-x86_64 -enable-kvm -nic user,hostfwd=tcp::2222-:22 -fsdev local,id=fs1,path=\u0026lt;host-shared-directory-path\u0026gt;,security_model=none -device virtio-9p-pci,fsdev=fs1,mount_tag=shared_directory -m 2g -smp cores=4,cpus=4 \u0026lt;image-path\u0026gt; and in /etc/fstab like this:\nshared_directory /home/user/shared 9p uid=1000,gid=1000,trans=virtio 0 0 Alright, that\u0026rsquo;s it. See you next time!\nSide Note If we want to use shutdown or reboot command from non-root user, we can install polkit package, like this:\n# @guest pacman -S polkit We can also ssh into the virtual machine from host machine. First we need to install openssh on virtual machine and host machine, don\u0026rsquo;t forget to start sshd service. And then, we create ssh key with this command:\n# @host ssh-keygen -t rsa -f ~/.ssh/qemu (we can change the name qemu with something else).\nAfter that, we can use this command to copy the ssh key into the virtual machine:\n# @host ssh-copy-id -i ~/.ssh/qemu.pub -p 2222 $USER@127.0.0.1 please keep in mind that we need to have the same username on the host machine and virtual machine. If you use different username on your virtual machine, you can change $USER with the username on your virtual machine.\nTo delete the hashed key of virtual machine from ssh known_hosts file, we can use this command:\n# @host ssh-keygen -R \u0026#39;[127.0.0.1]:2222\u0026#39; References  FLUSP Use QEMU To Play with Linux Kernel  Create an ArchLinux image for kernel testing .  "},{"ref":"https://bruhtus.github.io/posts/systemd-reset-failed-status/","title":"Systemd Reset Failed Status","section":"posts","tags":["Notes"],"date":"2023.07.18","body":"A Brief Intro Have you ever experience a failed systemd service and already trying to restart using systemctl restart \u0026lt;some-service\u0026gt; but the failed status still there?\nIf so, this short post might be for you! Let\u0026rsquo;s get started.\nReset Failed Status Now, if our systemd service has a failed status, we can try using command:\nsystemctl reset-failed \u0026lt;some-service\u0026gt; to remove the failed status and reset it to recent status.\nPlease keep in mind that reset-failed is dependent on Restart option, so if you use option Restart=always, there\u0026rsquo;s a chance that the failed status still there because systemd still trying to restart our service which result in another failed status.\nThere are still a lot more i need to learn about systemd service, so for now that\u0026rsquo;s all. See you next time!\n"},{"ref":"https://bruhtus.github.io/posts/docker-compose-down-without-yaml-file/","title":"Docker Compose Down Without Yaml File","section":"posts","tags":["Notes","Linux"],"date":"2023.03.22","body":"A Brief Intro Have you ever feel that you have too much docker container from spin up a bunch of docker-compose.yaml file? And when you want to take down all those docker container from the docker-compose.yml, you already delete the file?\nIf that\u0026rsquo;s the case, then this post might be for you.\nBefore we start, we will be using docker compose version 2.16.0 in this post. If you are using the older version of docker compose, then this method might not work. Please keep that in mind.\nCheck Docker Compose Project Name The first thing we need to do is to check the project name. We can do that with command:\ndocker-compose ls or if we use docker compose v2, we can use this command instead:\ndocker compose ls If the container already stopped, we can use flags -a or --all like this:\ndocker-compose ls -a or this:\ndocker compose ls -a By default, docker compose will use the docker-compose.yml directory name as project name. We can specify the project name with flag -p or --project-name like this:\ndocker-compose -p anu up -d or this:\ndocker compose -p anu up -d Please keep in mind that we need to use the flags -p or --project-name before the command such as up or down.\nTake Down Docker Compose Component After we know the project name, we can take down all docker component when we spin up the docker container from docker-compose.yml. The component in here means volume, network, or anything that we define inside docker-compose.yml.\nTo take down component from docker compose without the docker-compose.yml, we can use this command:\ndocker-compose -p project-name down \u0026lt;docker-compose-down-flags\u0026gt; or this:\ndocker compose -p project-name down \u0026lt;docker-compose-down-flags\u0026gt; For example, let\u0026rsquo;s say we want to take down docker component from project anu and also remove the volume from those project. We can do that with this command:\ndocker-compose -p anu down -v or this:\ndocker compose -p anu down -v Alright, that\u0026rsquo;s it!\nI am not sure since when the ls command appear in docker compose, so just to be safe i recommend using at least docker compose version 2.16.0.\nSide Note I\u0026rsquo;ve tried this method with docker compose version 1.18.0, but failed. After i downloaded the docker compose binary version 2.16.0 from github, i can use this method.\nStill not sure what was wrong. When i use command docker-compose --help, the flag -p in there. But when i actually spin up a new docker instance with command:\ndocker-compose -p project-name up -d service-name and then tried to take it down with command:\ndocker-compose -p project-name down -v i got an error docker-compose.yml not found or along those lines.\nIf someone know what\u0026rsquo;s going on, please let me know!\n"},{"ref":"https://bruhtus.github.io/posts/simple-guide-qmk-flashing-cli/","title":"Simple Guide Flashing Mechanical Keyboard with QMK CLI","section":"posts","tags":["Notes","Linux"],"date":"2023.02.26","body":"A Brief Intro So recently, around the time i wrote this post, i need to flash my mechanical keyboard. The harsh thing is that, the GUI QMK toolbox only available on windows and macOS, meanwhile i use linux.\nSo, i need to use the QMK CLI to flash my mechanical keyboard. This post is some kind of notes for my future self.\n\u0026ldquo;Humans live by forgetting\u0026rdquo;, some people said. Without further ado, let\u0026rsquo;s get started!\nInstall QMK Firmware First thing first, we need to check if QMK firmware already installed on our system. We can do that with the command below:\ncommand -v qmk If the output is empty, then we need to install QMK firmware first. If the output is not empty, we can skip this process.\nThere\u0026rsquo;s a newbie guide on how to install QMK firmware on linux, we can them out here .\nThere are a few options to install QMK firmware on linux. We can install QMK firmware with our linux distro package manager or from python pip.\nIn this post, we will use python pipx to install QMK firmware. We can install QMK firmware from python pipx with this command:\npipx install qmk  Make sure you already have pipx installed on your machine.\n Follow the instruction from the installation process, including installing dependencies on your system and copy the 50-qmk.rules to /etc/udev/rules.d/.\n Copying the 50-qmk.rules make QMK can detect the bootloader of our mechanical keyboard. If we didn\u0026rsquo;t do that, even if our mechanical keyboard already in bootloader mode, QMK won\u0026rsquo;t be able to detect our mechanical keyboard.\n After we install QMK firmware, we need to setup the QMK CLI. We can do that with this command:\nqmk setup By default, the installation directory will be on our home directory. Personally i don\u0026rsquo;t really want to put the QMK installation on my home directory, so i added -H flag to move the installation directory to somewhere else, like this:\nqmk setup -H all-repos/qmk_firmware If the setup already finished, try running:\nqmk doctor and see if there\u0026rsquo;s any issue with the installation.\nFlashing with QMK CLI There\u0026rsquo;s a newbie guide on how to flash our mechanical keyboard using QMK CLI, we can find it here .\nThe point is, we need to know if our mechanical keyboard supported by QMK. We can check the supported mechanical keyboard here .\nLet\u0026rsquo;s say our mechanical keyboard is dz60rgb with ansi layout version 1, we can flash our mechanical keyboard with this command:\nqmk flash -kb dztech/dz60rgb_ansi/v1 -km default  For more info about the flags, we can use qmk flash --help.\n Unfortunately, my current mechanical keyboard is not supported, which is synthesis60 version 2. I need to get the hex file from the mechanical keyboard designer (and fortunately he\u0026rsquo;s within reach).\n In case you also need the synthesis60 version 2 hex file, you can check it here .\n So, to use our own hex file rather than using the default that QMK supported, we can use this command:\nqmk flash \u0026lt;path-to-hex-file\u0026gt; Here\u0026rsquo;s an example:\nqmk flash ~/downloads/dyz_synthesis60_atmega_vial.hex All right, that\u0026rsquo;s it from me. See you next time!\nReferences  QMK newbie getting started guide . QMK newbie flashing guide . Using QMK flash with the external file .  "},{"ref":"https://bruhtus.github.io/posts/remove-specific-line-in-vim/","title":"Remove Specific Line in Vim","section":"posts","tags":["Notes","Vim"],"date":"2022.09.03","body":"A Brief Intro In this post, we will talk about how to remove specific line in vim. We will be using this javascript snippet code as an example:\nconst app = require(\u0026#39;./jest-example\u0026#39;); const math = require(\u0026#39;./math\u0026#39;); describe(\u0026#39;app operation\u0026#39;, () =\u0026gt; { const multiplyMock = jest.spyOn(math, \u0026#39;multiply\u0026#39;); multiplyMock.mockReturnValue(\u0026#39;itu\u0026#39;); test(\u0026#39;call math.add()\u0026#39;, () =\u0026gt; { const add = jest.spyOn(math, \u0026#39;add\u0026#39;); add.mockImplementation(() =\u0026gt; \u0026#39;anu\u0026#39;); console.log(app.doAdd(1, 2)); expect(app.doAdd(1, 2)).toBe(\u0026#39;anu\u0026#39;); add.mockRestore(); console.log(app.doAdd(1, 2)); expect(app.doAdd(1, 2)).toBe(3); }); test(\u0026#39;call math.subtract()\u0026#39;, () =\u0026gt; { const subtract = jest.spyOn(math, \u0026#39;subtract\u0026#39;); subtract.mockImplementation(() =\u0026gt; \u0026#39;nganu\u0026#39;); console.log(app.doSubtract(1, 2)); expect(app.doSubtract(1, 2)).toBe(\u0026#39;nganu\u0026#39;); }); test(\u0026#39;call math.subtract() again\u0026#39;, () =\u0026gt; { console.log(app.doSubtract(1, 2)); }); test(\u0026#39;call math.multiply()\u0026#39;, () =\u0026gt; { console.log(app.doMultiply(1, 2)); }); }); And the goal is to remove line that has console.log() in it. Let\u0026rsquo;s get started!\nGlobal Command The first solution is that, we can use global command to delete the line that has console.log() like this:\n:g/console.log/dPlease keep in mind that the term delete in vim, means cut. So, rather than deleting the content, vim will put that into the unnamed register. For more info about unnamed register, we can check on :help registers.\nSo, if we didn\u0026rsquo;t want to clutter our unnamed register, we can use black hole register (yup, that\u0026rsquo;s a thing) which actually delete rather than cut like this:\n:g/console.log/d_On a side note, we don\u0026rsquo;t need to use / as the separator between command and pattern, we can use most characters except \\, \u0026quot;, or |. If we use vim9 script, we can use # as a separator either, so please keep that in mind. For more info, we can check on :help pattern-delimiter.\nIn other words, we can write the previous global command, like this:\n:g;console.log;d_The global command that we just gone through will delete all the console.log in current file. If we want to specify the area of console.log we want to delete, we can add range to global command.\nLet\u0026rsquo;s take a look at the snippet we are using:\nconst app = require(\u0026#39;./jest-example\u0026#39;); const math = require(\u0026#39;./math\u0026#39;); describe(\u0026#39;app operation\u0026#39;, () =\u0026gt; { const multiplyMock = jest.spyOn(math, \u0026#39;multiply\u0026#39;); multiplyMock.mockReturnValue(\u0026#39;itu\u0026#39;); test(\u0026#39;call math.add()\u0026#39;, () =\u0026gt; { const add = jest.spyOn(math, \u0026#39;add\u0026#39;); add.mockImplementation(() =\u0026gt; \u0026#39;anu\u0026#39;); console.log(app.doAdd(1, 2)); expect(app.doAdd(1, 2)).toBe(\u0026#39;anu\u0026#39;); add.mockRestore(); console.log(app.doAdd(1, 2)); expect(app.doAdd(1, 2)).toBe(3); }); test(\u0026#39;call math.subtract()\u0026#39;, () =\u0026gt; { const subtract = jest.spyOn(math, \u0026#39;subtract\u0026#39;); subtract.mockImplementation(() =\u0026gt; \u0026#39;nganu\u0026#39;); console.log(app.doSubtract(1, 2)); expect(app.doSubtract(1, 2)).toBe(\u0026#39;nganu\u0026#39;); }); test(\u0026#39;call math.subtract() again\u0026#39;, () =\u0026gt; { console.log(app.doSubtract(1, 2)); }); test(\u0026#39;call math.multiply()\u0026#39;, () =\u0026gt; { console.log(app.doMultiply(1, 2)); }); }); And let\u0026rsquo;s say that our cursor in the line test('call math.subtract()', () =\u0026gt; { and we want to delete the console.log in test('call math.add()', () =\u0026gt; { which is before the line we\u0026rsquo;re currently in.\nWith that in mind, we can do something like this:\n:?test?;/});/g;console.log;d_Here\u0026rsquo;s the breakdown of those command:\n ?test? will search word test on previous line. ; after ?test? is a special offset which tell vim that we will use another search command. For more info, we can check :help //;. /});/ will search after the result of previous search. g;console.log;d_ is a global command to delete console.log in the scope of previous search.  Substitute Command The downside of global command is that there\u0026rsquo;s no confirm option, so we might delete something we don\u0026rsquo;t want to. If we want a confirm option, we can use substitute command.\nIf we want to delete all the console.log in current file, we can do it like this:\n:%s;.*console.log.*\\n;;cHere\u0026rsquo;s the breakdown of those command:\n % symbol to tell vim that the range is the current file or all the line in the file. s is the abbreviation of substitute command. .*console.log.*\\n is the pattern that select the line that has console.log in it, which include the newline character at the end. ;; is basically telling vim to replace it with nothing. c is a confirm option.  We can also combine substitute command with global command, like this:\n:g;console.log;s;.*\\n;;cConclusion There\u0026rsquo;s a lot of possibility with global and substitute command and we won\u0026rsquo;t be able to cover all of those in one blog post. So, i will leave it to you to explore those possibility.\nYou might want to learn regular expression to enhance the global and substitute command experience.\nAlright, that\u0026rsquo;s it for this post. Thank you for reading!\n"},{"ref":"https://bruhtus.github.io/posts/clean-up-untracked-file-in-git-repo/","title":"Clean Up Untracked File in Git Repo","section":"posts","tags":["Notes","Linux","Shell","Git"],"date":"2022.08.20","body":"Have you ever feels like deleting all the untracked file or directory in git repository is such a pain?\nIf you do, then this post might be for you!\nOk, first thing first, there is a git command clean which help us delete the untracked file. We can even use it with interactive interface. To invoke the interactive interface, we can use this command:\ngit clean -i . What that command does is prompt us an interactive interface with all the untracked file in current directory.\nTo make it start from the root of git repository, we can use this command:\ngit clean -i $(git rev-parse --show-toplevel) The git rev-parse --show-toplevel will get us the path of current git repository root. If you don\u0026rsquo;t know what i mean by git repository root, we can think of it as the directory or path that has .git directory.\nBut, the clean command has a downside. The clean command does not let us select specific file under untracked directory. It will only let us delete the entire untracked directory with all the file in it.\nTo get around this issue, we can make a shell alias like this:\nalias gurm=\u0026#39;git ls-files --others --exclude-standard | fzf --multi | xargs -r rm -v\u0026#39;  You can change gurm to anything you want.\n The dependencies from shell alias above are:\n git fzf xargs  git ls-files --others --exclude-standard will list all the untracked file and also exclude the file from .gitignore.\nfzf is a fuzzy finder to select the untracked file we want to remove, we also give flags --multi so that we can select multiple file with tab key.\nFinally, we execute rm command with xargs -r. What xargs -r do is make sure that we have some input from standard input (stdin), if there is no input from stdin, xargs will not execute the command. It is useful to prevent an error from a command that require an argument.\nAlright, that\u0026rsquo;s all. Have a nice day!\n"},{"ref":"https://bruhtus.github.io/posts/awk-print-row-instead-of-column/","title":"Awk Print Row Instead of Column","section":"posts","tags":["Notes","Linux","Shell"],"date":"2022.06.18","body":"Main Course Let\u0026rsquo;s say we have an output from xrandr --listactivemonitor like this:\nMonitors: 2 0: +*eDP-1 1920/344x1080/194+1920+0 eDP-1 1: +HDMI-2 1920/480x1080/270+0+0 HDMI-2 Now, we want to display only the second row which is this line:\n0: +*eDP-1 1920/344x1080/194+1920+0 eDP-1 We can do that using awk with this command:\nxrandr --listactivemonitor | awk \u0026#39;NR==2\u0026#39; or using process substitution command, like this:\nawk \u0026#39;NR==2\u0026#39; \u0026lt;(xrandr --listactivemonitor) If we also want to limit the row and the column, let\u0026rsquo;s say the second row and the third column which is result in this:\n1920/344x1080/194+1920+0 We can do that with this command:\nxrandr --listactivemonitor | awk \u0026#39;NR==2 {print $3}\u0026#39; or using process substitution command, like this:\nawk \u0026#39;NR==2 {print $3}\u0026#39; \u0026lt;(xrandr --listactivemonitor) Now, if we want to display the second to last row, which is this line:\n0: +*eDP-1 1920/344x1080/194+1920+0 eDP-1 1: +HDMI-2 1920/480x1080/270+0+0 HDMI-2 We can do that with this command:\nxrandr --listactivemonitor | awk \u0026#39;NR\u0026gt;=2\u0026#39; or using process substitution command, like this:\nawk \u0026#39;NR\u0026gt;=2\u0026#39; \u0026lt;(xrandr --listactivemonitor) Alright, that\u0026rsquo;s all. Thanks for reading and happy shell scripting!\nReference  Stackoverflow answer about awk for specific row .  "},{"ref":"https://bruhtus.github.io/posts/shell-process-substitution-as-temp-file/","title":"Shell Process Substitution as Temp File","section":"posts","tags":["Notes","Linux","Shell"],"date":"2022.06.11","body":"A Brief Intro This is all started when i\u0026rsquo;m trying to make a shell alias using fzf and git add -p command. And i was surprised that the interactive selection from git add -p immediately terminated before i can even press any key. Let\u0026rsquo;s get started, shall we?\nFirst Attempt My first attempt to make that shell alias was something like this:\nalias gap=\u0026#39;git status -s | awk \u0026#34;{print \\$2}\u0026#34; | fzf | xargs -r git add -p\u0026#39; Let me briefly explain one by one the command that i use in my shell alias:\n  git status -s -\u0026gt; The short format of git status, without unnecessary info (at least for me).\n  awk \u0026quot;{print \\$2}\u0026quot; -\u0026gt; Only use the second column. The backslash is to prevent shell to expand $2 into a second argument instead of a second column in awk.\n  fzf -\u0026gt; Fuzzy finder by Junegunn1.\n  xargs -r -\u0026gt; Do not run the command if there\u0026rsquo;s no standard input.\n  git add -p -\u0026gt; To add a chunk of changes, only works if the file already tracked by git.\n  This alias is where the problem arise. After i select the file name using fzf, the interactive interface of git add -p only appear for a few seconds and then terminated.\nAccording to stackoverflow answer2:\n Without further arguments xargs does not work with interactive (command line) applications.\nThe reason for that is, by default xargs gets its input from stdin but interactive applications also expect input from stdin.\nTo prevent the applications from grabbing input that is intended for xargs, xargs redirects stdin from /dev/null for the applications it runs.\nThis leads to the application just receiving an EOF3.\n With that in mind, we need to use --arg-file=\u0026lt;file\u0026gt; or -a \u0026lt;file\u0026gt; flag, which means that xargs will read from a \u0026lt;file\u0026gt; instead of stdin ( standard input) so that the stdin remains unchanged. Alright, let\u0026rsquo;s go to the second attempt.\nSecond Attempt Following the stackoverflow answer2, my second attempt was something like this:\nalias gap=\u0026#39;xargs -a \u0026lt;(git status -s | awk \u0026#34;{print \\$2}\u0026#34; | fzf) git add -p\u0026#39; The expression \u0026lt;(git status -s | awk \u0026quot;{print \\$2}\u0026quot; | fzf) is what we called process substitution (or to be precise, shell process substitution).\nInstead of using a file, we use a command to act like a temporary file.\nNow, the problem is, in my experiment i can\u0026rsquo;t use fzf with the shell process substitution because shell process substitution produces a special file that can only be opened and read, but not written or seeked4.\nCommands that treat their arguments as pure streams will works with shell process substitution, but the commands that seek a file they are given (or write to a file) won\u0026rsquo;t work4.\nAnd that is why we can\u0026rsquo;t use interactive command such as fzf with shell process substitution.\nConclusion With all the information from my experiment before, i decided to remove fzf from the alias, which result with this alias:\nalias gap=\u0026#39;xargs -a \u0026lt;(git status -s | awk \u0026#34;{print \\$2}\u0026#34;) git add -p\u0026#39; Is it fulfilling what i need? Not really, i might replace that with shell function instead of shell alias soon. But, i learn something new about shell process substitution.\nExtra Note For more info about the xargs and git flags, check the manpage. For example: man xargs or man git-add.\nIf we use echo with shell process substitution like this:\necho \u0026lt;(git status -s) That will show us where the temporary file created.\n  Fuzzy finder by Junegunn .\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n Stackoverflow: xargs explanation .\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n Triggering EOF explanation .\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n Process substitution result in special file .\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n   "},{"ref":"https://bruhtus.github.io/posts/replacement-for-info-command/","title":"Replacement For Info Command","section":"posts","tags":["Notes","Linux","Shell"],"date":"2022.06.11","body":"A Brief Intro Sometime ago, someone posted a tweet about a replacement for rm -rf $HOME/directory that is mv $HOME/directory /dev/null. When i took a look of it, using the ls -l /dev/null command, i found something like this:\ncrw-rw-rw- 1 root root 1, 3 Jun 11 04:21 /dev/null Now, what is c in the crw below\ncrw-rw-rw- 1 root root 1, 3 Jun 11 04:21 /dev/null After going around on internet, i found an answer in stackexchange1. Which explain that c stands for character special file. Please keep in mind that everything in unix-like system is a file, even a directory (or some people called it folder) is a file with type directory.\n The file we usually use has a type of regular file.\n In the stackexchange, someone mentioned about info ls to show the file type with their respective character symbol. That\u0026rsquo;s what pique my interest, the info command.\nReplacement For info Command When i use the command info ls, i noticed that i can\u0026rsquo;t use j and k for navigation, which is a nightmare.\nSo, the first thing that i need to figure out is, how to change the pager used in info command. According to this stackexchange answer2, \u0026ldquo;info doesn\u0026rsquo;t use separate pager because it handles navigation\u0026rdquo;. So, basically there\u0026rsquo;s no hope with info command? Probably.\nAnd then, the person who answer on the stackexchange also give a suggestion about pinfo which, at least use j and k as down or up movement. Now i need to read the manpage about pinfo to configure it.\nWhat\u0026rsquo;s Next? Other than trying to configure pinfo, i might need to figure out what is the info documents is all about. This might be a new kind of documentation other than manpage that i can use (if the developer support it). Also, figure out about the character special file type.\n  Stackexchange: The meaning of c in crw-rw-rw- \u0026#160;\u0026#x21a9;\u0026#xfe0e;\n Stackexchange: Replacement for info command \u0026#160;\u0026#x21a9;\u0026#xfe0e;\n   "}]